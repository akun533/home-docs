version: '3.8'

services:
  home-docs-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: home-docs:dev
    container_name: home-docs-dev
    ports:
      - "48080:80"
      - "43000:43000"
    environment:
      - NODE_ENV=development
      - PORT=43000
      - ALLOWED_ORIGINS=http://localhost:48080,http://localhost
    volumes:
      # 映射数据库文件到外部
      - ./data:/app/server/db/data
      # 映射文档目录，实现热更新
      - ./docs:/app/docs
      # 映射后端代码
      - ./server:/app/server
      # 映射构建脚本
      - ./add-footer-to-articles.js:/app/add-footer-to-articles.js
      # 映射 package.json
      - ./package.json:/app/package.json
    restart: unless-stopped

# 数据卷
volumes:
  data:
    driver: local
